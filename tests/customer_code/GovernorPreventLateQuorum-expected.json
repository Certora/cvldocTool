[
    {
        "type": "text",
        "text": "## Verification of GovernorPreventLateQuorum\r\n\r\n`GovernorPreventLateQuorum` extends the Governor group of contracts to add the\r\nfeature of giving voters more time to vote in the case that a proposal reaches\r\nquorum with less than `voteExtension` amount of time left to vote.\r\n\r\n### Assumptions and Simplifications\r\n\r\nNone\r\n\r\n#### Harnessing\r\n- The contract that the specification was verified against is\r\n`GovernorPreventLateQuorumHarness`, which inherits from all of the Governor\r\ncontracts \u2014 excluding Compound variations \u2014 and implements a number of view\r\nfunctions to gain access to values that are impossible/difficult to access in\r\nCVL. It also implements all of the required functions not implemented in the\r\nabstract contracts it inherits from.\r\n\r\n- `_castVote` was overriden to add an additional flag before calling the parent\r\nversion. This flag stores the `block.number` in a variable\r\n`latestCastVoteCall` and is used as a way to check when any of variations of\r\n`castVote` are called.\r\n\r\n#### Munging\r\n\r\n- Various variables' visibility was changed from private to internal or from\r\ninternal to public throughout the Governor contracts in order to make them\r\naccessible in the spec.\r\n\r\n- Arbitrary low level calls are assumed to change nothing and thus the function\r\n`_execute` is changed to do nothing. The tool normally havocs in this\r\nsituation, assuming all storage can change due to possible reentrancy. We\r\nassume, however, there is no risk of reentrancy because `_execute` is a\r\nprotected call locked behind the timelocked governance vote. All other\r\ngovernance functions are verified separately."
    },
    {
        "type": "text",
        "text": "Helper Functions"
    },
    {
        "type": "text",
        "text": "#### Definitions"
    },
    {
        "type": "text",
        "text": "***`deadlineExtendible:`*** A proposal is defined to be `deadlineExtendible` if its respective `extendedDeadline` variable is unset and quorum on that proposal has not been reached."
    },
    {
        "type": "text",
        "text": "***`deadlineExtended:`*** A proposal is defined to be `deadlineExtended` if its respective `extendedDeadline` variable is set and quorum on that proposal has been reached."
    },
    {
        "type": "text",
        "text": "***`proposalNotCreated:`*** A proposal is defined to be `proposalNotCreated` if its snapshot (block.number at which voting started), deadline, and `totalVotes` all equal 0."
    },
    {
        "type": "text",
        "text": "### Properties"
    },
    {
        "content": "/**\r\n * If a proposal has reached quorum then the proposal snapshot (start `block.number`) must be non-zero\r\n * @dev INVARIANT NOT PASSING // fails for updateQuorumNumerator and in the initial state when voting token total supply is 0 (causes quoromReached to return true)\r\n * @dev ADVANCED SANITY NOT RAN\r\n */",
        "id": "quorumReachedEffect",
        "title": "Quorum reached effect",
        "type": "invariant",
        "params": [
            {
                "type": "env",
                "name": "e"
            },
            {
                "type": "uint256",
                "name": "pId"
            }
        ],
        "return": {
            "type": "None"
        },
        "notice": "If a proposal has reached quorum then the proposal snapshot (start `block.number`) must be non-zero",
        "dev": "ADVANCED SANITY NOT RAN"
    },
    {
        "content": "/**\r\n * A created propsal must be in state deadlineExtendable or deadlineExtended.\r\n * @dev INVARIANT NOT PASSING // fails for updateQuorumNumerator and in the initial state when voting token total supply is 0 (causes quoromReached to return true)\r\n * @dev ADVANCED SANITY NOT RAN \r\n */",
        "id": "proposalInOneState",
        "title": "Proposal in one state",
        "type": "invariant",
        "params": [
            {
                "type": "env",
                "name": "e"
            },
            {
                "type": "uint256",
                "name": "pId"
            }
        ],
        "return": {
            "type": "None"
        },
        "notice": "A created propsal must be in state deadlineExtendable or deadlineExtended.",
        "dev": "ADVANCED SANITY NOT RAN"
    },
    {
        "type": "text",
        "text": "#### first set of rules"
    },
    {
        "type": "text",
        "text": "The rules [R1](#deadlineChangeEffects) and [R2](#deadlineCantBeUnextended)\r\nare assumed in rule [R3](#canExtendDeadlineOnce), so we prove them first."
    },
    {
        "content": "/**\r\n * If deadline increases then we are in `deadlineExtended` state and `castVote`\r\n * was called.\r\n * @dev RULE PASSING\r\n * @dev ADVANCED SANITY PASSING \r\n */",
        "id": "deadlineChangeEffects",
        "title": "Deadline change effects",
        "type": "rule",
        "params": [
            {
                "type": "method",
                "name": "f"
            }
        ],
        "return": {
            "type": "None"
        },
        "notice": "If deadline increases then we are in `deadlineExtended` state and `castVote`\r\nwas called.",
        "dev": "ADVANCED SANITY PASSING"
    },
    {
        "content": "/**\r\n * @title Deadline can't be unextended\r\n * @notice A proposal can't leave `deadlineExtended` state.\r\n * @dev RULE PASSING\r\n * @dev ADVANCED SANITY PASSING \r\n */",
        "id": "deadlineCantBeUnextended",
        "title": "Deadline can't be unextended",
        "type": "rule",
        "params": [
            {
                "type": "method",
                "name": "f"
            }
        ],
        "return": {
            "type": "None"
        },
        "notice": "A proposal can't leave `deadlineExtended` state.",
        "dev": "ADVANCED SANITY PASSING"
    },
    {
        "content": "/**\r\n * A proposal's deadline can't change in `deadlineExtended` state.\r\n * @dev RULE PASSING\r\n * @dev ADVANCED SANITY PASSING \r\n */",
        "id": "canExtendDeadlineOnce",
        "title": "Can extend deadline once",
        "type": "rule",
        "params": [
            {
                "type": "method",
                "name": "f"
            }
        ],
        "return": {
            "type": "None"
        },
        "notice": "A proposal's deadline can't change in `deadlineExtended` state.",
        "dev": "ADVANCED SANITY PASSING"
    },
    {
        "type": "text",
        "text": "#### second set of rules"
    },
    {
        "type": "text",
        "text": "The main rule in this section is [the deadline can only extended if quorum reached w/ <= timeOfExtension left to vote](#deadlineExtenededIfQuorumReached)\r\nThe other rules of this section are assumed in the proof, so we prove them\r\nfirst."
    },
    {
        "content": "/**\r\n * A change in hasVoted must be correlated with an increasing of the vote\r\n * supports, i.e. casting a vote increases the total number of votes.\r\n * @dev RULE PASSING\r\n * @dev ADVANCED SANITY PASSING\r\n */",
        "id": "hasVotedCorrelationNonzero",
        "title": "Has voted correlation nonzero",
        "type": "rule",
        "params": [
            {
                "type": "uint256",
                "name": "pId"
            },
            {
                "type": "method",
                "name": "f"
            },
            {
                "type": "env",
                "name": "e"
            }
        ],
        "return": {
            "type": "None"
        },
        "notice": "A change in hasVoted must be correlated with an increasing of the vote\r\nsupports, i.e. casting a vote increases the total number of votes.",
        "dev": "ADVANCED SANITY PASSING"
    },
    {
        "content": "/**\r\n * @title Against votes don't count\r\n * @notice An against vote does not make a proposal reach quorum.\r\n * @dev RULE PASSING\r\n * @dev --ADVANCED SANITY PASSING vacuous but keeping\r\n */",
        "id": "againstVotesDontCount",
        "title": "Against votes don't count",
        "type": "rule",
        "params": [
            {
                "type": "method",
                "name": "f"
            }
        ],
        "return": {
            "type": "None"
        },
        "notice": "An against vote does not make a proposal reach quorum.",
        "dev": "--ADVANCED SANITY PASSING vacuous but keeping"
    },
    {
        "content": "/**\r\n * Deadline can only be extended from a `deadlineExtendible` state with quorum being reached with <= `lateQuorumVoteExtension` time left to vote\r\n * @dev RULE PASSING\r\n * @dev ADVANCED SANITY PASSING \r\n */",
        "id": "deadlineExtenededIfQuorumReached",
        "title": "Deadline exteneded if quorum reached",
        "type": "rule",
        "params": [
            {
                "type": "method",
                "name": "f"
            }
        ],
        "return": {
            "type": "None"
        },
        "notice": "Deadline can only be extended from a `deadlineExtendible` state with quorum being reached with <= `lateQuorumVoteExtension` time left to vote",
        "dev": "ADVANCED SANITY PASSING"
    },
    {
        "content": "/**\r\n * `extendedDeadlineField` is set iff `_castVote` is called and quroum is reached.\r\n * @dev RULE PASSING\r\n * @dev ADVANCED SANITY PASSING \r\n */",
        "id": "extendedDeadlineValueSetIfQuorumReached",
        "title": "Extended deadline value set if quorum reached",
        "type": "rule",
        "params": [
            {
                "type": "method",
                "name": "f"
            }
        ],
        "return": {
            "type": "None"
        },
        "notice": "`extendedDeadlineField` is set iff `_castVote` is called and quroum is reached.",
        "dev": "ADVANCED SANITY PASSING"
    },
    {
        "content": "/**\r\n * Deadline can never be reduced.\r\n * @dev RULE PASSING\r\n * @dev ADVANCED SANITY PASSING\r\n */",
        "id": "deadlineNeverReduced",
        "title": "Deadline never reduced",
        "type": "rule",
        "params": [
            {
                "type": "method",
                "name": "f"
            }
        ],
        "return": {
            "type": "None"
        },
        "notice": "Deadline can never be reduced.",
        "dev": "ADVANCED SANITY PASSING"
    }
]
